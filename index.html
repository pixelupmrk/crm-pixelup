<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRM PixelUp – Kanban</title>
  <meta name="description" content="CRM PixelUp – Kanban simples com arrastar e soltar, edição e persistência local." />
  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#0e1424;
      --panel-2:#121a2e;
      --text:#e6f0ff;
      --muted:#9fb3d9;
      --primary:#00b2ff;        /* neon azul */
      --primary-2:#66d1ff;
      --success:#18c964;
      --danger:#ff4d6d;
      --warning:#ffcc00;
      --shadow: 0 10px 25px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.04) inset;
      --glow: 0 0 12px rgba(0,178,255,.45), 0 0 40px rgba(0,178,255,.2);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      background: radial-gradient(1000px 600px at 20% -10%, rgba(0,178,255,.15), transparent 60%),
                  radial-gradient(800px 600px at 120% 10%, rgba(102,209,255,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
    }

    /* Header */
    .topbar{
      position:sticky; top:0; z-index:40;
      background: linear-gradient(180deg, rgba(11,15,26,.85), rgba(11,15,26,.65) 60%, transparent);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:16px;}
    .brand{
      display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.3px;
    }
    .logo{
      width:34px; height:34px; border-radius:10px; display:grid; place-items:center;
      background: radial-gradient(100% 100% at 30% 20%, var(--primary) 0%, #0070c0 60%, #003b73 100%);
      color:white; box-shadow: var(--glow), inset 0 0 12px rgba(0,0,0,.3);
      font-weight:900;
    }
    .tools{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:12px;
    }
    input[type="search"]{
      width:min(420px, 100%); padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background: var(--panel); color:var(--text); outline:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
    }
    .btn{
      appearance:none; border:none; border-radius:12px; padding:10px 14px; cursor:pointer;
      color:var(--text); background: var(--panel); border:1px solid rgba(255,255,255,.08);
      transition:.2s transform, .2s background, .2s border-color, .2s box-shadow;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(102,209,255,.35); box-shadow: var(--glow); }
    .btn.primary{ background: linear-gradient(180deg, var(--primary), #0894d1); color:#00111a; font-weight:700; box-shadow: var(--glow); border-color: transparent;}
    .btn.ghost{ background: transparent; }
    .btn.small{ padding:8px 10px; font-size:.9rem; border-radius:10px; }

    /* Board */
    .board{
      max-width:1200px; margin:12px auto 40px; padding:0 16px;
      display:grid; gap:14px; grid-template-columns: repeat(4, 1fr);
    }
    @media (max-width:1100px){ .board{ grid-template-columns: repeat(3, 1fr);} }
    @media (max-width:800px){ .board{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:560px){ .board{ grid-template-columns: 1fr; } }

    .col{
      background: linear-gradient(180deg, rgba(0,178,255,.08), transparent 140%) , var(--panel-2);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius); overflow:hidden; box-shadow: var(--shadow);
      min-height: 220px; display:flex; flex-direction:column;
    }
    .col-header{
      display:flex; align-items:center; justify-content:space-between; padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06); background: rgba(0,0,0,.12);
    }
    .col-title{font-weight:700; display:flex; align-items:center; gap:10px;}
    .badge{
      font-size:.75rem; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.08); color:var(--muted);
      border:1px solid rgba(255,255,255,.12);
    }
    .dropzone{ padding:12px; display:flex; flex-direction:column; gap:10px; flex:1; }
    .dropzone.dragover{ outline:2px dashed var(--primary); outline-offset:-6px; background: rgba(0,178,255,.06); }

    /* Cards */
    .card{
      background: var(--panel); border:1px solid rgba(255,255,255,.1);
      border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:8px;
      cursor:grab; box-shadow: var(--shadow); transition:.15s transform, .15s box-shadow, .15s border-color;
    }
    .card:hover{ transform: translateY(-2px); border-color: rgba(102,209,255,.35); box-shadow: var(--glow); }
    .card:active{ cursor:grabbing; }
    .card-top{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .title{ font-weight:700; }
    .meta{ color:var(--muted); font-size:.9rem; display:flex; flex-wrap:wrap; gap:10px; }
    .pill{ font-size:.75rem; padding:4px 8px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); }
    .value{ font-weight:800; letter-spacing:.2px; }
    .actions{ display:flex; gap:8px; }
    .icon-btn{
      width:32px; height:32px; display:grid; place-items:center; border-radius:10px; background: transparent;
      border:1px solid rgba(255,255,255,.12); color:var(--text); cursor:pointer;
    }
    .icon-btn:hover{ border-color: rgba(102,209,255,.4); box-shadow: var(--glow); }

    /* Modal (flutuante, central) */
    .modal{
      position: fixed; inset:0; display:none; place-items:center; background: rgba(4,8,16,.6); backdrop-filter: blur(6px);
      z-index: 100;
    }
    .modal.open{ display:grid; }
    .dialog{
      width:min(560px, 92vw); background: var(--panel-2); border:1px solid rgba(255,255,255,.12); border-radius:18px;
      box-shadow: 0 50px 120px rgba(0,0,0,.6), var(--glow); padding:16px;
      transform: translateY(0); animation: pop .14s ease-out;
    }
    @keyframes pop{ from{ transform: translateY(8px); opacity:.8 } to{ transform:none; opacity:1 } }
    .dialog h3{ margin:0 0 8px 0; }
    .grid{ display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    @media (max-width:520px){ .grid{ grid-template-columns: 1fr; } }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field label{ color:var(--muted); font-size:.9rem; }
    .field input, .field textarea, .field select{
      background: var(--panel); color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:10px;
      padding:10px 12px; outline:none;
    }
    .dialog .footer{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px; }
    .left{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .right{ display:flex; gap:8px; }

    /* toast */
    .toast{
      position: fixed; bottom:18px; left:50%; transform: translateX(-50%);
      background: rgba(14,20,36,.9); border:1px solid rgba(255,255,255,.12); color:var(--text);
      padding:10px 14px; border-radius:12px; box-shadow: var(--shadow); z-index:120; display:none;
    }
    .toast.show{ display:block; animation: fade 2.2s ease-out; }
    @keyframes fade{ 0%{opacity:0; transform:translate(-50%,10px)} 10%,80%{opacity:1; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,-6px)} }

    /* helpers */
    .hidden{ display:none !important; }
    a{ color:var(--primary-2); text-decoration: none; }
    .note{ color:var(--muted); font-size:.92rem; }
    .sep{ height:1px; background: rgba(255,255,255,.08); margin:8px 0; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <div class="brand">
        <div class="logo">UP</div>
        <div>
          <div style="font-size:1.05rem">CRM <span style="color:var(--primary)">PixelUp</span></div>
          <div class="note">Kanban com arrastar-e-soltar, edição rápida e salvamento local</div>
        </div>
      </div>

      <div class="tools">
        <input id="search" type="search" placeholder="Buscar por nome, empresa, telefone, observação…" />
        <button class="btn small" id="btn-exportar" title="Exportar JSON">Exportar</button>
        <label class="btn small ghost" style="cursor:pointer">
          Importar <input id="file-import" type="file" accept="application/json" style="display:none" />
        </label>
        <button class="btn small ghost" id="btn-reset" title="Apagar tudo (localStorage)">Reset</button>
        <span class="note">• Dica: clique no card para editar • arraste para mudar de coluna</span>
      </div>
    </div>
  </header>

  <main class="board" id="board">
    <!-- Colunas serão desenhadas por JS -->
  </main>

  <!-- Modal de Lead -->
  <div class="modal" id="modal">
    <div class="dialog" role="dialog" aria-modal="true">
      <h3 id="modal-title">Novo Lead</h3>
      <div class="grid">
        <div class="field">
          <label for="lead-name">Nome</label>
          <input id="lead-name" placeholder="Ex.: Maria Silva" />
        </div>
        <div class="field">
          <label for="lead-company">Empresa</label>
          <input id="lead-company" placeholder="Ex.: M2 Multimarcas" />
        </div>
        <div class="field">
          <label for="lead-phone">Telefone (Whats)</label>
          <input id="lead-phone" placeholder="(47) 9 9999-9999" />
        </div>
        <div class="field">
          <label for="lead-value">Valor (R$)</label>
          <input id="lead-value" inputmode="decimal" placeholder="Ex.: 2.500" />
        </div>
        <div class="field">
          <label for="lead-status">Fase</label>
          <select id="lead-status"></select>
        </div>
        <div class="field">
          <label for="lead-tags">Tags (separe por vírgula)</label>
          <input id="lead-tags" placeholder="instagram, campanha, carro" />
        </div>
        <div class="field" style="grid-column:1 / -1">
          <label for="lead-notes">Observações</label>
          <textarea id="lead-notes" rows="4" placeholder="Anote objeções, dores, próximos passos…"></textarea>
        </div>
      </div>
      <div class="footer">
        <div class="left">
          <button class="btn small" id="btn-duplicar" title="Duplicar lead">Duplicar</button>
          <button class="btn small" id="btn-excluir" style="color:#ffdce5;border-color:rgba(255,77,109,.4)">Excluir</button>
        </div>
        <div class="right">
          <button class="btn small ghost" id="btn-cancelar">Cancelar</button>
          <button class="btn small primary" id="btn-salvar">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // === Utilitários ==========================================================
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const uid = () => Math.random().toString(36).slice(2,9) + Date.now().toString(36).slice(-4);
    const fmtMoney = (v) => {
      if (v===null || v===undefined || v==="") return "";
      const n = Number(String(v).replace(/\./g,'').replace(',','.'));
      if (isNaN(n)) return String(v);
      return n.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}).replace(/\u00A0/g,' ');
    }
    const toast = (msg) => {
      const el = $('#toast'); el.textContent = msg; el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 2200);
    }

    // === Estado & Persistência ================================================
    const STORAGE_KEY = 'pixelupCRM_v1';
    const defaultColumns = [
      { key:'novos',      name:'Novos'      , color:'#66d1ff'},
      { key:'contato',    name:'Contato'    , color:'#7cf6d7'},
      { key:'negociacao', name:'Negociação' , color:'#ffd166'},
      { key:'fechado',    name:'Fechado'    , color:'#ff8fa3'},
    ];
    const state = {
      columns: [...defaultColumns],
      leads: [],
    };
    const load = () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw){
        // amostra inicial
        state.leads = [
          {id:uid(), name:'Carlos Andrade', company:'Barbearia Cauan', phone:'(47) 9 8888-8888', value:1500, notes:'Quer iniciar tráfego local.', tags:['barbearia','meta'], status:'novos', createdAt:Date.now()},
          {id:uid(), name:'Mai Cristina', company:'Mai Cristina Studio', phone:'(47) 99664-6177', value:2200, notes:'Interesse em pacote Premium + conteúdos.', tags:['massagem','conteúdo'], status:'contato', createdAt:Date.now()},
          {id:uid(), name:'Maiko', company:'M2 Multimarcas', phone:'(47) 99760-5173', value:4800, notes:'Campanhas de carros + stories semanais.', tags:['concessionária','tráfego'], status:'negociacao', createdAt:Date.now()},
          {id:uid(), name:'Vitrine Autos', company:'Vitrine Autos', phone:'(47) 9 7777-7777', value:3900, notes:'Fechou plano Intermediário.', tags:['autos','ads'], status:'fechado', createdAt:Date.now()-86400000},
        ];
        save();
      }else{
        const parsed = JSON.parse(raw);
        state.columns = parsed.columns ?? defaultColumns;
        state.leads   = parsed.leads   ?? [];
      }
    }
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    // === Render das Colunas & Cards ===========================================
    const board = $('#board');
    function renderBoard(){
      board.innerHTML = '';
      for (const col of state.columns){
        const colEl = document.createElement('section');
        colEl.className = 'col';
        colEl.dataset.key = col.key;
        colEl.innerHTML = `
          <div class="col-header">
            <div class="col-title">
              <div style="width:10px;height:10px;border-radius:999px;background:${col.color};box-shadow:0 0 12px ${col.color}"></div>
              ${col.name}
              <span class="badge" data-count>0</span>
            </div>
            <div class="actions">
              <button class="icon-btn" title="Novo lead nesta coluna" data-add>
                ➕
              </button>
            </div>
          </div>
          <div class="dropzone" data-dropzone></div>
        `;
        board.appendChild(colEl);

        const dz = $('[data-dropzone]', colEl);
        dz.addEventListener('dragover', onDragOver);
        dz.addEventListener('dragleave', onDragLeave);
        dz.addEventListener('drop', (e)=> onDrop(e, col.key));

        $('[data-add]', colEl).addEventListener('click', ()=> openModal({status:col.key}));
      }
      renderCards();
    }

    function renderCards(){
      // filtro
      const q = $('#search').value.trim().toLowerCase();
      const match = (lead) => {
        if (!q) return true;
        return [lead.name, lead.company, lead.phone, lead.notes, ...(lead.tags||[])].filter(Boolean).some(t => String(t).toLowerCase().includes(q));
      }

      // limpar dropzones
      $$('.dropzone').forEach(dz => dz.innerHTML = '');

      for (const lead of state.leads){
        if (!match(lead)) continue;
        const card = document.createElement('article');
        card.className = 'card';
        card.draggable = true;
        card.dataset.id = lead.id;
        card.innerHTML = `
          <div class="card-top">
            <div class="title">${escapeHTML(lead.name || 'Sem nome')}</div>
            <div class="actions">
              <button class="icon-btn" title="Abrir WhatsApp" data-whats>💬</button>
              <button class="icon-btn" title="Editar" data-edit>✏️</button>
            </div>
          </div>
          <div class="meta">
            ${lead.company ? `<span class="pill">${escapeHTML(lead.company)}</span>` : ''}
            ${lead.phone ? `<span class="pill">☎ ${escapeHTML(lead.phone)}</span>` : ''}
            ${lead.value!==undefined && lead.value!=='' ? `<span class="pill value">${fmtMoney(lead.value)}</span>` : ''}
          </div>
          ${Array.isArray(lead.tags) && lead.tags.length ? `<div class="meta">${lead.tags.map(t=>`<span class="pill">#${escapeHTML(t)}</span>`).join('')}</div>`:''}
          ${lead.notes ? `<div class="note">📝 ${escapeHTML(lead.notes)}</div>`:''}
        `;
        card.addEventListener('dragstart', onDragStart);
        card.addEventListener('click', (e)=>{
          if (e.target.closest('[data-edit]')) { e.stopPropagation(); openModal(lead); return; }
          if (e.target.closest('[data-whats]')) { e.stopPropagation(); openWhats(lead); return; }
          // clique em qualquer lugar do card também edita:
          openModal(lead);
        });
        const dz = $(`.col[data-key="${lead.status}"] .dropzone`);
        (dz ?? $('.col .dropzone')).appendChild(card);
      }

      // atualizar contadores
      for (const col of state.columns){
        const count = $(`.col[data-key="${col.key}"] [data-count]`);
        const n = state.leads.filter(l => l.status === col.key && (!q || true)).length;
        if (count) count.textContent = n;
      }
    }

    function escapeHTML(s){
      return String(s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // === Drag & Drop ==========================================================
    let dragId = null;
    function onDragStart(e){
      dragId = e.currentTarget.dataset.id;
      e.dataTransfer.setData('text/plain', dragId);
      // fantasma menor
      const crt = e.currentTarget.cloneNode(true);
      crt.style.width = getComputedStyle(e.currentTarget).width;
      crt.style.opacity = '.7';
      document.body.appendChild(crt);
      e.dataTransfer.setDragImage(crt, 20, 20);
      setTimeout(()=> crt.remove(), 0);
    }
    function onDragOver(e){
      e.preventDefault(); e.currentTarget.classList.add('dragover');
    }
    function onDragLeave(e){
      e.currentTarget.classList.remove('dragover');
    }
    function onDrop(e, newStatus){
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      const id = e.dataTransfer.getData('text/plain') || dragId;
      const card = $(`.card[data-id="${CSS.escape(id)}"]`);
      if (!card) return;
      e.currentTarget.appendChild(card);
      const lead = state.leads.find(l => l.id === id);
      if (lead){
        lead.status = newStatus; save(); renderCards();
        toast(`Movido para "${(state.columns.find(c=>c.key===newStatus)||{}).name || newStatus}"`);
      }
    }

    // === Modal de edição ======================================================
    let currentId = null; // null = criando
    const modal = $('#modal');
    const statusSelect = $('#lead-status');

    function openModal(data={}){
      currentId = data.id ?? null;
      $('#modal-title').textContent = currentId ? 'Editar Lead' : 'Novo Lead';
      $('#lead-name').value = data.name ?? '';
      $('#lead-company').value = data.company ?? '';
      $('#lead-phone').value = data.phone ?? '';
      $('#lead-value').value = data.value ?? '';
      $('#lead-notes').value = data.notes ?? '';
      $('#lead-tags').value = (data.tags ?? []).join(', ');

      // preencher opções de status
      statusSelect.innerHTML = state.columns.map(c => `<option value="${c.key}">${c.name}</option>`).join('');
      statusSelect.value = data.status ?? state.columns[0].key;

      $('#btn-excluir').style.display = currentId ? 'inline-flex' : 'none';
      $('#btn-duplicar').style.display = currentId ? 'inline-flex' : 'none';

      modal.classList.add('open');
      setTimeout(()=> $('#lead-name').focus(), 10);
    }
    function closeModal(){ modal.classList.remove('open'); }

    $('#btn-cancelar').addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=> { if (e.target === modal) closeModal(); });

    $('#btn-salvar').addEventListener('click', ()=>{
      const payload = {
        name: $('#lead-name').value.trim(),
        company: $('#lead-company').value.trim(),
        phone: $('#lead-phone').value.trim(),
        value: $('#lead-value').value.trim(),
        notes: $('#lead-notes').value.trim(),
        tags: $('#lead-tags').value.split(',').map(s=>s.trim()).filter(Boolean),
        status: statusSelect.value,
        createdAt: Date.now(),
      };
      if (currentId){
        const i = state.leads.findIndex(l => l.id === currentId);
        if (i>-1) state.leads[i] = {...state.leads[i], ...payload};
        toast('Lead atualizado');
      }else{
        const lead = { id: uid(), ...payload };
        state.leads.unshift(lead);
        toast('Lead criado');
      }
      save(); renderCards(); closeModal();
    });

    $('#btn-excluir').addEventListener('click', ()=>{
      if (!currentId) return;
      if (confirm('Excluir este lead?')){
        const i = state.leads.findIndex(l => l.id === currentId);
        if (i>-1) state.leads.splice(i,1);
        save(); renderCards(); closeModal(); toast('Lead excluído');
      }
    });

    $('#btn-duplicar').addEventListener('click', ()=>{
      if (!currentId) return;
      const base = state.leads.find(l => l.id===currentId);
      if (!base) return;
      const dup = {...base, id:uid(), name: base.name + ' (cópia)'};
      state.leads.unshift(dup);
      save(); renderCards(); toast('Lead duplicado');
    });

    function openWhats(lead){
      // Abre link universal do WhatsApp
      const phoneDigits = (lead.phone || '').replace(/\D/g,'');
      if (!phoneDigits){ toast('Telefone inválido'); return; }
      const text = encodeURIComponent(`Olá ${lead.name || ''}! Aqui é a PixelUp 🚀`);
      const url = `https://wa.me/55${phoneDigits}?text=${text}`;
      window.open(url, '_blank');
    }

    // === Busca, Export/Import, Reset =========================================
    $('#search').addEventListener('input', renderCards);

    $('#btn-exportar').addEventListener('click', ()=>{
      const data = JSON.stringify({columns: state.columns, leads: state.leads}, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'pixelup-crm.json'; a.click();
      URL.revokeObjectURL(url);
    });

    $('#file-import').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          if (Array.isArray(data.leads)) state.leads = data.leads;
          if (Array.isArray(data.columns)) state.columns = data.columns;
          save(); renderBoard(); toast('Importado com sucesso');
        }catch(err){
          alert('Arquivo inválido.');
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    });

    $('#btn-reset').addEventListener('click', ()=>{
      if (confirm('Apagar todos os dados (localStorage)?')){
        localStorage.removeItem(STORAGE_KEY);
        load(); renderBoard(); toast('Reset concluído');
      }
    });

    // === Inicialização ========================================================
    load();
    renderBoard();

    // Acessibilidade: mover por menu contextual no mobile (sem DnD)
    document.addEventListener('contextmenu', (e)=>{
      const card = e.target.closest('.card'); if (!card) return;
      e.preventDefault();
      const id = card.dataset.id;
      const lead = state.leads.find(l => l.id === id); if (!lead) return;
      const nomes = state.columns.map(c=>c.name);
      const destino = prompt('Mover para qual coluna?\n' + nomes.map((n,i)=> `${i+1}. ${n}`).join('\n'));
      const idx = Number(destino)-1;
      if (!isNaN(idx) && state.columns[idx]){
        lead.status = state.columns[idx].key; save(); renderCards(); toast('Lead movido');
      }
    });
  </script>

  <!--
  OPCIONAL: Métricas (ex.: Plausible). Cole sua tag abaixo se quiser medir uso.
  <script defer data-domain="seu-dominio.vercel.app" src="https://plausible.io/js/script.js"></script>
  -->
</body>
</html>
